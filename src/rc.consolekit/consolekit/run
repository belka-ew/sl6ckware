#!/bin/execlineb -P

###############################
# Start the consolekit daemon #
###############################

foreground { echo "Starting longrun service:  consolekit" }
backtick -ni CONSOLE-KIT-DAEMON { which console-kit-daemon }
# ConsoleKit renamed database~ to database in /var/run/ConsoleKit when it's ready.
# We will use it for its readiness indicator.
if { mkdir -p /var/run/ConsoleKit }
background {
  fdmove 1 3
  inotifywait -qe moved_to --include database /var/run/ConsoleKit
}
fdclose 3
importas -u console-kit-daemon CONSOLE-KIT-DAEMON
foreground { echo "Starting ConsoleKit daemon:  ${console-kit-daemon} --no-daemon" }
emptyenv $console-kit-daemon --no-daemon
