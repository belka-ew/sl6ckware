#!/bin/execlineb -P

################################
# Start crond (Dillon's crond) #
################################

foreground { echo "Starting longrun service:  crond" }
backtick -ni CROND { which crond }
if { mkdir -p /var/run/cron }
# Using /var/run/cron/cron-* appearance as readiness indicator
background {
  fdmove 1 3
  inotifywait -qe attrib /var/run/cron
}
fdclose 3
pipeline { sed "/CROND_OPTS=/!d; s/\"//g; s/ /_/g" /etc/default/crond }
envfile -
multisubstitute {
  importas -u crond CROND
  importas -usd"_" crond_opts CROND_OPTS
}
foreground { echo "Starting crond:  ${crond}" $crond_opts }
emptyenv $crond $crond_opts
