#!/bin/execlineb -P

#####################################
# Start the system-wide dbus-daemon #
#####################################

foreground { echo "Starting longrun service:  messagebus" }
backtick -ni DBUS-UUIDGEN { which dbus-uuidgen }
backtick -ni DBUS-DAEMON { which dbus-daemon }
export DBUS-DAEMON_OPTS "--system --nofork --nopidfile --print-pid=3 --syslog-only"
multisubstitute {
  importas -u dbus-uuidgen DBUS-UUIDGEN
  importas -u dbus-daemon DBUS-DAEMON
  importas -u dbus-daemon_opts DBUS-DAEMON_OPTS
}
if { [ -x $dbus-uuidgen -a -x $dbus-daemon ] }
foreground { echo "Starting system message bus:  ${dbus-uuidgen} --ensure ; ${dbus-daemon} ${dbus-daemon_opts}" }
if { $dbus-uuidgen --ensure }
emptyenv $dbus-daemon $dbus-daemon_opts
