#!/bin/execlineb -P

################################################
# Start the Network Time Protocol (NTP) daemon #
################################################

fdmove -c 2 1
# ntpd initialization ends not long after it reads its config file (by default,
# it's /etc/ntp.conf) thus we will use it as ntpd readiness indicator.
ifelse { [ ! -r /etc/ntp.conf ] }
{
  foreground { echo "ntpd: No ntpd config file found! Aborting..." }
  exit 125
}
background -d {
  fdmove 1 3
  inotifywait -qe close /etc/ntp.conf
}
s6-envdir env
multisubstitute {
  importas -u CMD CMD
  importas -usCd" " CMD_OPTS CMD_OPTS
}
exec -c $CMD $CMD_OPTS
