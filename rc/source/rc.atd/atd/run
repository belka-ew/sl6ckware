#!/bin/execlineb -P

################################################
# Start atd (manages jobs scheduled with 'at') #
################################################

fdmove -c 2 1
backtick -ni ATD { which atd }
pipeline -d { sed "/ATD_OPTS=/!d; s/\"//g; s/ /_/g" /etc/default/atd }
envfile -
multisubstitute {
  importas -u atd ATD
  importas -usd"_" atd_opts ATD_OPTS
}
foreground { echo "atd: Starting atd: ${atd} -d" $atd_opts }
# Using /var/run/atd.pid availability as readiness indicator
s6-notifyoncheck -dc "[ -r /var/run/atd.pid ]"
emptyenv $atd -d $atd_opts
