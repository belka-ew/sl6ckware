#!/bin/execlineb -P

###############################
# Start the ConsoleKit daemon #
###############################

fdmove -c 2 1
backtick -ni CONSOLE-KIT-DAEMON { which console-kit-daemon }
# ConsoleKit renamed database~ to database in /var/run/ConsoleKit when it's ready.
# We will use it for its readiness indicator.
if { mkdir -p /var/run/ConsoleKit }
background -d {
  fdmove 1 3
  ifelse { [ -r /var/run/ConsoleKit/database ] } { echo }
  inotifywait -qe moved_to --include database /var/run/ConsoleKit
}
fdclose 3
importas -u console-kit-daemon CONSOLE-KIT-DAEMON
foreground { echo "consolekitd: Starting ConsoleKit daemon: ${console-kit-daemon} --no-daemon" }
emptyenv $console-kit-daemon --no-daemon
